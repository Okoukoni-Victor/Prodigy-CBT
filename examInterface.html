<html
  lang="en"
  x-data="{ theme: localStorage.getItem('theme') || 'light' }"
  x-init="$watch('theme', value => localStorage.setItem('theme', value))"
  style="transition: all 0.4s ease"
>
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, shrink-to-fit=no"
    />
    <title>Prodigy - Exam Interface</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Lora:wght@400;600&display=swap"
      rel="stylesheet"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css"
      rel="stylesheet"
    />
    <link href="assets/css/app.css" rel="stylesheet" />
    <script
      defer
      src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"
    ></script>

    <style>
      body {
        font-family: "Lora", serif;
      }

      input.bg-dark::placeholder,
      textarea.bg-dark::placeholder {
        color: white;
        opacity: 1;
      }

      .intro-card {
        max-width: 400px;
      }

      .question-passage {
        max-height: 200px;
        overflow-y: auto;
      }

      .question-image,
      .option-image {
        width: 150px;
        object-fit: contain;
      }

      .option-label {
        transition: all 0.3s ease-in-out;
      }

      .option-label:hover,
      .form-check-input:checked + .option-label {
        background-color: var(--bs-primary) !important;
        color: white !important;
        box-shadow: 0 0 8px rgba(0, 0, 0, 0.2);
      }
    </style>
  </head>
  <body x-data="examInterface">
    <!-- Exam Intro -->
    <template x-if="showIntro">
      <div
        class="d-flex align-items-center justify-content-center vh-100 bg-dark bg-opacity-75 position-fixed w-100 top-0 start-0"
      >
        <div
          class="card text-center p-4 bg-light shadow-lg rounded-4 intro-card"
        >
          <h2 class="fw-bold text-primary" x-text="selectedExam.subject"></h2>
          <p class="fw-semibold" x-text="selectedExam.description"></p>

          <hr />

          <div class="d-flex justify-content-between text-dark fw-semibold">
            <div>
              <i class="bi bi-question-circle text-primary"></i>
              Questions: <span x-text="selectedExam.questions.length"></span>
            </div>
            <div>
              <i class="bi bi-clock text-danger"></i>
              Duration: <span x-text="formatTime(selectedExam.duration)"></span>
            </div>
          </div>

          <hr />

          <p class="fs-6">
            Ensure you read each question carefully. You can flag questions for
            review and navigate between them freely.
          </p>

          <button class="btn btn-success btn-lg mt-3 w-100" @click="startExam">
            Start Exam <i class="bi bi-play-circle"></i>
          </button>
        </div>
      </div>
    </template>

    <div class="wrapper">
      <div class="main" :class="{ 'bg-dark bg-opacity-50': theme === 'dark' }">
        <main class="content">
          <div class="container-fluid p-0" x-show="!showIntro">
            <!-- Exam Details -->
            <div
              class="mx-5 fixed-top card py-3 px-4 shadow-sm z-1"
              :class="{ 'bg-dark text-white': theme === 'dark', 'bg-white text-dark': theme !== 'dark' }"
            >
              <div class="d-flex justify-content-between align-items-center">
                <div>
                  <h2
                    class="fw-bold text-primary"
                    x-text="selectedExam.subject"
                  ></h2>
                  <p
                    class="fw-semibold text-dark"
                    :class="{ 'text-white': theme === 'dark' }"
                    x-text="selectedExam.description"
                  ></p>
                </div>

                <div class="d-flex gap-3 align-items-center flex-wrap">
                  <!-- Dark Mode Toggle Switch -->
                  <button
                    type="button"
                    @click="toggleTheme()"
                    class="btn btn-sm d-inline-flex gap-2 align-items-center bg-white border border-light rounded-pill"
                  >
                    <span
                      class="p-1 d-inline-flex align-items-center justify-content-center rounded-circle small"
                      :class="theme === 'light' ? 'bg-dark text-white' : 'bg-transparent text-secondary'"
                      style="
                        width: 20px;
                        height: 20px;
                        transition: all 0.3s ease;
                      "
                      aria-label="Switch to light mode"
                    >
                      <i class="bi bi-brightness-high"></i>
                    </span>

                    <span
                      class="p-1 d-inline-flex align-items-center justify-content-center rounded-circle small"
                      :class="theme === 'dark' ? 'bg-dark text-white' : 'bg-transparent text-secondary'"
                      style="
                        width: 20px;
                        height: 20px;
                        transition: all 0.3s ease;
                      "
                      aria-label="Switch to dark mode"
                    >
                      <i class="bi bi-moon"></i>
                    </span>
                  </button>

                  <span
                    class="fw-semibold py-2 px-4 bg-warning text-dark rounded-pill"
                    style="width: 200px; text-align: center"
                  >
                    Time Left: <span x-text="formatTime(timer)"></span>
                  </span>
                </div>
              </div>
            </div>

            <div class="row mt-5">
              <div class="col-md-8 mt-5">
                <div class="card p-4" :class="{ 'bg-dark': theme === 'dark' }">
                  <!-- Passage Display -->
                  <div
                    x-show="selectedExam.questions[currentQuestion].passage"
                    class="card mb-5 shadow-sm question-passage"
                  >
                    <div class="card-header bg-info text-white fw-bold lead">
                      Passage
                    </div>
                    <div
                      class="card-body bg-light"
                      x-html="selectedExam.questions[currentQuestion].passage"
                    ></div>
                  </div>

                  <!-- Question Header -->
                  <div
                    class="d-flex align-items-center justify-content-between mb-3"
                  >
                    <h4
                      class="text-dark mb-0"
                      :class="{ 'text-white': theme === 'dark' }"
                    >
                      <strong>
                        Question <span x-text="currentQuestion + 1"></span> of
                        <span x-text="selectedExam.questions.length"></span>
                      </strong>
                    </h4>
                    <button
                      @click="flagQuestion"
                      class="btn btn-sm"
                      :class="flagged[currentQuestion] ? 'bg-warning text-white' : 'btn-outline-warning'"
                      title="Flag this question"
                    >
                      <i class="bi bi-flag-fill"></i>
                    </button>
                  </div>

                  <!-- Question Text and Image -->
                  <div class="mb-4">
                    <p
                      class="lead"
                      :class="{ 'text-white': theme === 'dark' }"
                      x-html="selectedExam.questions[currentQuestion].text"
                    ></p>
                    <img
                      x-show="selectedExam.questions[currentQuestion].image"
                      :src="selectedExam.questions[currentQuestion].image"
                      class="img-fluid rounded question-image"
                      alt="Question Image"
                    />
                  </div>

                  <!-- Options Rendering -->
                  <div class="mt-4">
                    <!-- MCQ Variations -->
                    <template
                      x-if="selectedExam.questions[currentQuestion].type === 'mcq'"
                    >
                      <div>
                        <!-- Text-only options (text_question_text_options,
                          text_and_image_question_text_options) -->
                        <template
                          x-if="selectedExam.questions[currentQuestion].variation === 'text_question_text_options'
                           || selectedExam.questions[currentQuestion].variation === 'text_and_image_question_text_options'"
                        >
                          <div>
                            <template
                              x-for="(option, index) in selectedExam.questions[currentQuestion].options"
                              :key="index"
                            >
                              <div class="form-check my-3">
                                <input
                                  class="form-check-input d-none"
                                  type="radio"
                                  :id="'option' + index"
                                  :name="'question' + currentQuestion"
                                  x-model="answers[currentQuestion]"
                                  :value="option.text"
                                />
                                <label
                                  class="option-label d-block px-3 py-2 cursor-pointer rounded fw-semibold"
                                  :class="{
                          'bg-primary text-white': answers[currentQuestion] === option.text,
                          'bg-light text-dark': theme === 'light' && answers[currentQuestion] !== option.text,
                          'bg-dark text-white': theme === 'dark' && answers[currentQuestion] !== option.text
                        }"
                                  :for="'option' + index"
                                >
                                  <strong
                                    x-text="String.fromCharCode(97 + index) + ')'"
                                  ></strong>
                                  <span x-text="option.text"></span>
                                </label>
                              </div>
                            </template>
                          </div>
                        </template>

                        <!-- Image options (text_question_image_options, text_and_image_question_image_options) -->
                        <template
                          x-if="selectedExam.questions[currentQuestion].variation === 'text_question_image_options'
                        || selectedExam.questions[currentQuestion].variation === 'text_and_image_question_image_options'"
                        >
                          <div class="row row-cols-1 row-cols-md-2 g-3">
                            <template
                              x-for="(option, index) in selectedExam.questions[currentQuestion].options"
                              :key="index"
                            >
                              <div class="col">
                                <input
                                  class="form-check-input d-none"
                                  type="radio"
                                  :id="'option' + index"
                                  :name="'question' + currentQuestion"
                                  x-model="answers[currentQuestion]"
                                  :value="index"
                                />
                                <label
                                  class="option-label d-block p-3 cursor-pointer rounded text-center shadow-sm"
                                  :class="{
                            'bg-primary text-white': answers[currentQuestion] === index,
                            'bg-light text-dark': theme === 'light' && answers[currentQuestion] !== index,
                            'bg-dark text-white': theme === 'dark' && answers[currentQuestion] !== index
                          }"
                                  :for="'option' + index"
                                >
                                  <strong
                                    x-text="String.fromCharCode(97 + index) + ')'"
                                  ></strong>
                                  <img
                                    :src="option.image"
                                    class="img-fluid mt-2 option-image"
                                    alt="Option Image"
                                  />
                                </label>
                              </div>
                            </template>
                          </div>
                        </template>
                      </div>
                    </template>

                    <!-- Subjective Variations -->
                    <template
                      x-if="selectedExam.questions[currentQuestion].type === 'subjective'"
                    >
                      <div class="row row-cols-1 row-cols-md-2 g-3">
                        <template
                          x-for="i in [...Array(selectedExam.questions[currentQuestion].answerCount).keys()]"
                          :key="i"
                        >
                          <div class="col">
                            <label
                              class="form-label fw-semibold"
                              :class="{ 'text-white': theme === 'dark', 'text-dark': theme !== 'dark' }"
                              x-text="selectedExam.questions[currentQuestion].answerCount > 1 ? 
                              ['I','II','III','IV','V','VI','VII','VIII','IX','X'][i] : ''"
                            ></label>
                            <input
                              type="text"
                              class="form-control"
                              :class="{ 'bg-dark text-white': theme === 'dark', 'text-dark': theme !== 'dark' }"
                              x-model="answers[currentQuestion][i]"
                              placeholder="Type your answer"
                            />
                          </div>
                        </template>
                      </div>
                    </template>

                    <!-- Essay -->
                    <template
                      x-if="selectedExam.questions[currentQuestion].type === 'essay'"
                    >
                      <div>
                        <textarea
                          class="form-control mb-3"
                          :class="{ 'bg-dark text-white': theme === 'dark', 'text-dark': theme !== 'dark' }"
                          rows="8"
                          x-model="answers[currentQuestion]"
                          placeholder="Type your essay here or upload a file below"
                        ></textarea>
                        <div class="mb-3">
                          <label
                            for="essay-upload"
                            class="form-label fw-semibold"
                            :class="{ 'bg-dark text-white': theme === 'dark', 'text-dark': theme !== 'dark' }"
                          >
                            Upload Essay File (e.g., .docx, .pdf):
                          </label>
                          <input
                            type="file"
                            class="form-control mb-2"
                            :class="{ 'bg-dark text-white': theme === 'dark', 'text-muted': theme !== 'dark' }"
                            id="essay-upload"
                            accept=".doc,.docx,.txt,.pdf"
                            @change="handleFileUpload($event, currentQuestion)"
                          />
                          <small
                            class="form-text mt-2"
                            :class="{ 'bg-dark text-white': theme === 'dark', 'text-muted': theme !== 'dark' }"
                            x-show="!files[currentQuestion]"
                          >
                            Type your essay in Microsoft Word, save it, and
                            upload it here. Supported formats: .doc, .docx,
                            .txt, .pdf.
                          </small>
                        </div>
                      </div>
                    </template>
                  </div>

                  <!-- Question Navigation -->
                  <div
                    class="mt-4 d-flex justify-content-between align-items-center"
                  >
                    <button
                      class="btn btn-outline-secondary btn-lg"
                      @click="prevQuestion"
                      :disabled="currentQuestion === 0"
                    >
                      <i class="bi bi-arrow-left"></i> Prev
                    </button>
                    <button
                      x-show="currentQuestion !== selectedExam.questions.length - 1"
                      class="btn btn-primary btn-lg"
                      @click="nextQuestion"
                    >
                      Next <i class="bi bi-arrow-right"></i>
                    </button>
                    <button
                      x-show="currentQuestion === selectedExam.questions.length - 1"
                      class="btn btn-danger btn-lg"
                      @click="showConfirmModal = true"
                    >
                      Submit Exam
                    </button>
                  </div>
                </div>
              </div>

              <!-- Question Review Panel -->
              <div class="col-md-4 mt-5">
                <div class="card p-3" :class="{ 'bg-dark': theme === 'dark' }">
                  <h5 class="text-center text-dark fw-bold mb-4">
                    Question Review
                  </h5>
                  <div class="d-flex flex-wrap align-items-center gap-1">
                    <template
                      x-for="(question, index) in selectedExam.questions"
                      :key="index"
                    >
                      <button
                        style="width: 33px; height: 33px"
                        class="btn btn-sm fw-bold rounded-circle"
                        :class="{
                          'border border-2 border-primary': currentQuestion === index,
                          'bg-warning text-white': flagged[index],
                          'bg-success text-white': answers[index],
                          'bg-danger text-white': !answers[index] && !flagged[index]
                        }"
                        @click="currentQuestion = index"
                        x-text="index + 1"
                      ></button>
                    </template>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </main>
      </div>
    </div>

    <!-- Fullscreen Exit Warning Modal -->
    <div
      class="modal fade bg-dark bg-opacity-75 z-3"
      :class="{ 'show d-block': showFullscreenWarning }"
      tabindex="-1"
      aria-hidden="true"
    >
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
          <div class="modal-header">
            <h5
              class="modal-title text-danger fw-bold d-flex align-items-center gap-"
            >
              <i class="bi-exclamation-triangle-fill fs-3"></i>
              Fullscreen Exited
            </h5>
          </div>
          <div class="modal-body">
            <p>
              You exited fullscreen! This may be considered cheating.<br />
              Do you want to return to the exam?
            </p>
          </div>
          <div class="modal-footer">
            <button
              class="btn btn-secondary"
              @click="showFullscreenWarning = false; fullscreenExitFlagged = true; setTimeout(() => fullscreenExitFlagged = false, 5000);"
            >
              Cancel
            </button>

            <button
              class="btn btn-primary"
              @click="enterFullscreen(); showFullscreenWarning = false"
            >
              Return to Fullscreen
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Fullscreen Exit Flagged Alert -->
    <div
      x-show="fullscreenExitFlagged"
      :class="{ 'show': fullscreenExitFlagged }"
      x-transition
      class="alert alert-danger fade position-fixed top-0 start-0 m-3 p-2 shadow d-flex align-items-center z-3"
    >
      <i class="bi bi-exclamation-triangle-fill me-2 fs-4"></i>
      <div>
        <strong>Warning:</strong> You have been flagged for possible cheating.
      </div>
    </div>

    <!-- 5-minute Alert -->
    <div
      x-show="showNotification"
      class="alert alert-warning position-fixed top-0 start-50 translate-middle-x fw-bold p-3 m-3 z-3"
    >
      <i class="bi bi-hourglass-split display-6 me-3"></i>
      <div>
        <strong class="fs-5">5 MINUTES REMAINING!</strong><br />
        <span class="small">Hurry up and finalize your answers.</span>
      </div>
    </div>

    <!-- Confirm Submission Modal -->
    <div
      class="modal fade bg-dark bg-opacity-75 z-3"
      :class="{ 'show d-block': showConfirmModal }"
      tabindex="-1"
      aria-labelledby="submitModalLabel"
      aria-hidden="true"
    >
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="submitModalLabel">
              Confirm Submission
            </h5>
          </div>
          <div class="modal-body">
            Are you sure you want to submit the exam?
          </div>
          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-secondary"
              @click="showConfirmModal = false"
            >
              Cancel
            </button>
            <button type="button" class="btn btn-success" @click="submitExam">
              Submit
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Submission Success Modal -->
    <div
      class="modal fade bg-dark bg-opacity-75 z-3"
      :class="{ 'show d-block': showSuccessModal }"
      tabindex="-1"
      aria-labelledby="successModalLabel"
      aria-hidden="true"
    >
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-body text-center p-4 shadow-lg">
            <h3 class="text-success fw-bold">Exam Submitted!</h3>
            <p class="text-muted">Thank you for completing the exam.</p>
            <button class="btn btn-primary mt-2" @click="redirectToDashboard">
              Go to Dashboard
            </button>
          </div>
        </div>
      </div>
    </div>

    <script>
      document.addEventListener("alpine:init", () => {
        Alpine.data("examInterface", () => ({
          showIntro: true,
          selectedExam: null,
          answers: {},
          flagged: {},
          files: {},
          currentQuestion: 0,
          timer: 0,
          timerInterval: null,
          showFullscreenWarning: false,
          fullscreenExitFlagged: false,
          showNotification: false,
          showConfirmModal: false,
          showSuccessModal: false,

          theme: localStorage.getItem("theme") || "light",

          init() {
            this.applyTheme();
            this.$watch("theme", (value) => {
              localStorage.setItem("theme", value);
              this.applyTheme();
            });
          },

          applyTheme() {
            document.documentElement.classList.toggle(
              "dark",
              this.theme === "dark"
            );
          },

          toggleTheme() {
            this.theme = this.theme === "light" ? "dark" : "light";
          },

          exams: [
            {
              id: "EXM001",
              subject: "Mathematics",
              description:
                "Mathematics Final Exam covering Algebra and Calculus.",
              date: "2025-08-12",
              startTime: "10:00 AM",
              duration: 5400,
              status: "Pending",
              questions: [
                { text: "What is 2 + 2?", options: ["3", "4", "5", "6"] },
                { text: "What is 5 x 3?", options: ["8", "15", "10", "20"] },
              ],
            },
            {
              id: "EXM003",
              subject: "Chemistry",
              description:
                "Chemistry Final Exam on Organic Chemistry and Chemical Reactions.",
              date: "2025-08-18",
              startTime: "2:00 PM",
              duration: 4500,
              status: "Pending",
              questions: [
                {
                  text: "What is the atomic number of Carbon?",
                  options: ["6", "12", "14", "16"],
                },
                {
                  text: "What is the chemical symbol for Gold?",
                  options: ["Ag", "Au", "Pb", "Fe"],
                },
              ],
            },
            {
              id: "EXM005",
              subject: "English Language",
              description:
                "English Language Exam testing grammar, comprehension, and writing skills.",
              date: "2025-08-07",
              startTime: "3:00 PM",
              duration: 3000,
              status: "Pending",
              questions: [
                {
                  text: "Which of these is a noun?",
                  options: ["Run", "Happy", "Apple", "Quickly"],
                },
                {
                  text: "What is the synonym of 'big'?",
                  options: ["Small", "Large", "Tiny", "Short"],
                },
              ],
            },
            {
              id: "EXM008",
              subject: "Geography",
              description:
                "Geography Exam on Physical Geography and Environmental Issues.",
              date: "2025-07-12",
              startTime: "10:00 PM",
              duration: 310,
              status: "Pending",
              questions: [
                {
                  type: "mcq",
                  variation: "text_question_text_options",
                  text: "Which of the following is the longest river in the world?",
                  options: [
                    { text: "Nile River" },
                    { text: "Amazon River" },
                    { text: "Yangtze River" },
                    { text: "Mississippi River" },
                  ],
                },
                {
                  type: "mcq",
                  variation: "text_question_text_options",
                  passage:
                    "The Earth's atmosphere is divided into several layers based on temperature and composition. The troposphere, the lowest layer, contains most of the atmosphere's mass and is where weather phenomena occur. Above it lies the stratosphere, which houses the ozone layer that absorbs harmful ultraviolet radiation. The mesosphere, thermosphere, and exosphere follow, each with distinct characteristics. The thermosphere, for instance, experiences extremely high temperatures due to solar radiation absorption.",
                  text: "According to the passage, which atmospheric layer contains the ozone layer?",
                  options: [
                    { text: "Troposphere" },
                    { text: "Stratosphere" },
                    { text: "Mesosphere" },
                    { text: "Thermosphere" },
                  ],
                },
                {
                  type: "mcq",
                  variation: "text_question_image_options",
                  text: "Which of the following images depicts the Himalayan mountain range?",
                  options: [
                    { image: "assets/img/image.jpg" },
                    { image: "assets/img/image.jpg" },
                    { image: "assets/img/image.jpg" },
                    { image: "assets/img/image.jpg" },
                  ],
                },
                {
                  type: "mcq",
                  variation: "text_and_image_question_text_options",
                  text: "Which biome is depicted in the image below?",
                  image: "assets/img/image.jpg",
                  options: [
                    { text: "Desert" },
                    { text: "Tundra" },
                    { text: "Tropical Rainforest" },
                    { text: "Temperate Grassland" },
                  ],
                },
                {
                  type: "mcq",
                  variation: "text_and_image_question_image_options",
                  text: "What is the next stage of river valley development after the stage shown in the diagram below?",
                  image: "assets/img/image.jpg",
                  options: [
                    { image: "assets/img/image.jpg" },
                    { image: "assets/img/image.jpg" },
                    { image: "assets/img/image.jpg" },
                    { image: "assets/img/image.jpg" },
                  ],
                },
                {
                  type: "subjective",
                  variation: "text_question",
                  text: "What is the primary source of energy for Earth's climate system?",
                  answerCount: 1,
                },
                {
                  type: "subjective",
                  variation: "text_question",
                  passage:
                    "Glaciers are large masses of ice formed from accumulated snow that compacts over time. They flow slowly under their own weight, shaping landscapes through erosion and deposition. Glaciers are critical indicators of climate change, as their retreat or advance reflects global temperature trends. For example, the retreat of glaciers in the Alps and Himalayas has accelerated due to rising global temperatures.",
                  text: "According to the passage, what process causes glaciers to shape landscapes?",
                  answerCount: 1,
                },
                {
                  type: "subjective",
                  variation: "text_question",
                  passage:
                    "Desertification is the process by which fertile land degrades into desert-like conditions, often due to human activities and climate change. Overgrazing, deforestation, and unsustainable agricultural practices strip the land of vegetation, leading to soil erosion and reduced productivity. In regions like the Sahel, desertification threatens food security and livelihoods.",
                  text: "List two human activities mentioned in the passage that contribute to desertification.",
                  answerCount: 2,
                },
                {
                  type: "subjective",
                  variation: "text_question",
                  text: "Name three types of renewable energy sources.",
                  answerCount: 3,
                },
                {
                  type: "subjective",
                  variation: "text_and_image_question",
                  text: "What type of rock is shown in the image below?",
                  image: "assets/img/image.jpg",
                  answerCount: 1,
                },
                {
                  type: "subjective",
                  variation: "text_and_image_question",
                  text: "List three physical characteristics of the coral reef shown in the image below.",
                  image: "assets/img/image.jpg",
                  answerCount: 3,
                },
                {
                  type: "subjective",
                  variation: "text_and_image_question",
                  text: "Label the parts of the water cycle diagram below.",
                  image: "assets/img/image.jpg",
                  answerCount: 4,
                },
                {
                  type: "essay",
                  text: "Discuss the causes and consequences of global warming, and suggest two mitigation strategies.",
                },
              ],
            },
            {
              id: "EXM010",
              subject: "Literature",
              description:
                "Literature Exam on Shakespeare and 19th Century Novels.",
              date: "2025-08-11",
              startTime: "12:30 PM",
              duration: 4500,
              status: "Pending",
              questions: [
                {
                  text: "Who wrote 'Romeo and Juliet'?",
                  options: ["Shakespeare", "Hemingway", "Austen", "Dickens"],
                },
                {
                  text: "What is the main theme of '1984'?",
                  options: ["Freedom", "Totalitarianism", "Love", "War"],
                },
              ],
            },
            {
              id: "EXM011",
              subject: "Accounting",
              description:
                "Accounting Exam on Financial Statements and Costing.",
              date: "2025-08-13",
              startTime: "2:00 PM",
              duration: 3600,
              status: "Pending",
              questions: [
                {
                  text: "What is a balance sheet?",
                  options: [
                    "Income statement",
                    "Financial position",
                    "Trial balance",
                    "Expense report",
                  ],
                },
                {
                  text: "What does GAAP stand for?",
                  options: [
                    "Generally Accepted Accounting Principles",
                    "Global Accounting Advisory Program",
                    "General Asset Allocation Plan",
                    "Government Audit Accounting Process",
                  ],
                },
              ],
            },
            {
              id: "EXM012",
              subject: "History",
              description:
                "History Exam covering World Wars and Historical Movements.",
              date: "2025-08-17",
              startTime: "9:30 AM",
              duration: 4200,
              status: "Pending",
              questions: [
                {
                  text: "When did World War II end?",
                  options: ["1943", "1945", "1950", "1960"],
                },
                {
                  text: "Who was the first President of the USA?",
                  options: [
                    "Abraham Lincoln",
                    "George Washington",
                    "Thomas Jefferson",
                    "John Adams",
                  ],
                },
              ],
            },
            {
              id: "EXM015",
              subject: "Civic Education",
              description:
                "Civic Education Exam on Nigerian Constitution and Governance.",
              date: "2025-08-19",
              startTime: "3:30 PM",
              duration: 3000,
              status: "Pending",
              questions: [
                {
                  text: "Who is the current President of Nigeria?",
                  options: ["Buhari", "Tinubu", "Jonathan", "Obasanjo"],
                },
                {
                  text: "What is the capital of Nigeria?",
                  options: ["Lagos", "Abuja", "Kano", "Port Harcourt"],
                },
              ],
            },
          ],

          init() {
            // Get the examId from the URL
            const params = new URLSearchParams(window.location.search);
            const examId = params.get("examId");

            // Find the matching exam
            if (examId) {
              this.selectedExam =
                this.exams.find((exam) => exam.id === examId) || null;
            }

            document.addEventListener("fullscreenchange", () => {
              if (
                !document.fullscreenElement &&
                !this.showIntro &&
                !this.showSuccessModal
              ) {
                this.showFullscreenWarning = true;
              }
            });
          },

          enterFullscreen() {
            const doc = document.documentElement;
            if (doc.requestFullscreen) doc.requestFullscreen();
            else if (doc.webkitRequestFullscreen) doc.webkitRequestFullscreen();
            else if (doc.msRequestFullscreen) doc.msRequestFullscreen();
          },

          exitFullscreen() {
            if (document.exitFullscreen) document.exitFullscreen();
            else if (document.webkitExitFullscreen)
              document.webkitExitFullscreen();
            else if (document.msExitFullscreen) document.msExitFullscreen();
          },

          prevQuestion() {
            if (this.currentQuestion > 0) this.currentQuestion--;
          },

          nextQuestion() {
            if (this.currentQuestion < this.selectedExam.questions.length - 1)
              this.currentQuestion++;
          },

          flagQuestion() {
            this.flagged[this.currentQuestion] =
              !this.flagged[this.currentQuestion];
          },

          handleFileUpload(event, index) {
            const file = event.target.files[0];
            if (file) {
              this.files[index] = file;
              console.log("File uploaded for question", index, file.name);
            }
          },

          startExam() {
            this.enterFullscreen();
            this.showIntro = false;
            this.timer = this.selectedExam.duration;

            this.timerInterval = setInterval(() => {
              if (this.timer > 0) {
                this.timer--;
                if (this.timer === 300) {
                  this.showNotification = true;
                  setTimeout(() => (this.showNotification = false), 5000);
                }
              } else {
                clearInterval(this.timerInterval);
                this.submitExam();
              }
            }, 1000);
          },

          submitExam() {
            if (this.showSuccessModal) return;

            this.showConfirmModal = false;

            if (this.timerInterval) {
              clearInterval(this.timerInterval);
              this.timerInterval = null;
            }

            this.showSuccessModal = true;
          },

          redirectToDashboard() {
            window.location.href = "candidateDashboard.html";
          },

          formatTime(seconds) {
            let hr = Math.floor(seconds / 3600);
            let min = Math.floor((seconds % 3600) / 60);
            let sec = seconds % 60;
            return `${hr}h ${min}m ${sec}s`;
          },
        }));
      });
    </script>
  </body>
</html>
